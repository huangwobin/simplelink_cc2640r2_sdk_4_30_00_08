

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Software Architecture &mdash; 
SimpleLink™ CC2640R2 SDK
BLE5-Stack User&#39;s Guide
 1.01.11.00 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TI-RTOS (RTOS Kernel) Overview" href="tirtos-index.html" />
    <link rel="prev" title="TI BLE5-Stack Quick Start" href="../quickstart-guide/ble5-quick-start-cc2640.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug ble-stack-5.x-guide software_architecture";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for TI beyond RTD Sphinx Theme --->
<div class="DocSite-globalNav tiNav">
    <ul>
    </ul>
</div>

<a class="DocSite-nav" href="https://www.ti.com" style="padding-bottom: 85px;">
  <img class="DocSiteNav-logo"
    src="../_static/img/ti_logo.png"
    alt="TI Logo">
  <div class="DocSiteNav-title"></div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index-cc2640.html" class="icon icon-home" alt="Documentation Home"> 
SimpleLink™ CC2640R2 SDK
BLE5-Stack User's Guide

          

          
          </a>

          
            
            
              <div class="version">
                1.01.11.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-guide/ble5-quick-start-cc2640.html">TI BLE5-Stack Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#stack-protocol-stack-and-application-configurations">BLE5-Stack Protocol Stack and Application Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solution-platform">Solution Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ble-software-architecture">BLE Software Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-project-configuration">Single Project Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stack-library-configuration">Stack Library Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#standard-project-task-hierarchy">Standard Project Task Hierarchy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-hex-and-binary-files">Working With Hex and Binary Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#programming-internal-flash-with-the-rom-bootloader">Programming Internal Flash with the ROM Bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resetting-the-device-via-software">Resetting the CC2640R2 via software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tirtos-index.html">TI-RTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ble-stack-5-index-cc2640.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="ble-stack-5-index-cc2640.html#ble5-stack">BLE5-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="ble-stack-5-index-cc2640.html#developing-a-custom-application">Developing a Custom Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="ble-stack-5-index-cc2640.html#running-the-sdk-on-custom-hardware">Running the SDK on Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../voice/voice.html">Creating a Voice Enabled Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration-cc2640.html">Updating from previous SDKs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference-cc2640.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-cc2640.html">Terms and Definitions</a></li>
</ul>

            
          
          <!-- extra nav elements for TI beyond RTD Sphinx Theme --->
<div id="sideBanner">
    <br/>
    <br/><br/><br/>
</div>
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index-cc2640.html">
SimpleLink™ CC2640R2 SDK
BLE5-Stack User's Guide
</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index-cc2640.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Software Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="software-architecture">
<h1>Software Architecture<a class="headerlink" href="#software-architecture" title="Permalink to this headline">¶</a></h1>
<p>The TI royalty-free Bluetooth Low Energy protocol stack is a software component in
the CC2640R2 SDK for developing single-mode Bluetooth Low Energy (BLE)
standalone and network processor applications. This component is based on the
SimpleLink CC2640R2 family of BLE enabled wireless MCUs. The CC2640R2 combines a
2.4-GHz RF transceiver (some wireless MCUs may also contain a Sub-1GHz transceiver which is
not used with BLE), 352 KB of in-system programmable flash memory, 80 KB of SRAM, and
a full complement of peripherals. The CC2640R2 wireless MCU is centered on an Arm®
Cortex®-M4F series processor that handles the application layer and
Bluetooth Low Energy protocol stack, and an autonomous radio core centered on an
Arm Cortex-M0 processor that handles all the low-level radio control
and processing associated with the physical layer (PHY).
The Sensor Controller Engine (SCE) block provides additional flexibility by allowing
autonomous data acquisition and processing independent of the Cortex-M4F processor,
further extending the low-power capabilities of the CC2640R2.
For more information on the CC2640R2, see the <a class="reference external" href="http://www.ti.com/lit/pdf/swcu117">CC13x0 CC26x0 SimpleLink Wireless MCU Technical Reference Manual</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Sensor Controller is not available on the <a class="reference external" href="https://www.ti.com/product/CC2640R2L">CC2640R2L</a>.</p>
</div>
<p>The application developer interfaces with the protocol stack through a set of
C APIs (ICall) to implement a Bluetooth Low Energy application. Although applications can
be created using C++, all BLE protocol stack APIs must be accessed through the C context.
The rest of this document intends to document application development on the CC2640R2
using the Bluetooth Low Energy stack.</p>
<div class="section" id="stack-protocol-stack-and-application-configurations">
<h2>BLE5-Stack Protocol Stack and Application Configurations<a class="headerlink" href="#stack-protocol-stack-and-application-configurations" title="Permalink to this headline">¶</a></h2>
<p>The BLE stack platform supports two different protocol stack and application operational configurations:</p>
<ul class="simple">
<li><strong>Single device:</strong> The BLE controller, host, profiles, and application are all
implemented on the wireless MCU as a true single-chip solution. This
configuration is the simplest and most common when using the CC2640R2. This
configuration is used by most of TI’s sample projects. This configuration is
the most cost-effective technique and provides the lowest-power performance.</li>
<li><strong>Network processor:</strong> The BLE controller and host reside on the wireless MCU with
the application and profile residing on an external application processer (AP). Communication
with the wireless MCU occurs over a UART or SPI interface using the serialized Network Processor
Interface (NPI) protocol. Using NPI, the AP controls the network processor with a
combination of TI Vendor Specific Host Controller Interface (HCI) commands and
Bluetooth HCI commands. The network processor option is ideal for adding BLE to an existing
non-wireless application. It is important to note that the network processor is not a pure
HCI LE controller-only implementation and the application must use TI Vendor Specific
HCI commands for BLE Host operations.</li>
</ul>
</div>
<div class="section" id="solution-platform">
<h2>Solution Platform<a class="headerlink" href="#solution-platform" title="Permalink to this headline">¶</a></h2>
<p>This section describes the various components that are installed with
BLE5-Stack 1.01.11.00 and the directory structure of the protocol stack
and any tools required for development.</p>
<p><a class="reference internal" href="#fig-single-network-processor-configuration"><span class="std std-numref">Figure 39.</span></a> shows the BLE5-Stack
development system. Unless otherwise noted, BLE5-Stack applications must be built with component
from this CC2640R2 SDK.</p>
<div class="figure align-center" id="id2">
<span id="fig-single-network-processor-configuration"></span><img alt="../_images/image8.jpeg" src="../_images/image8.jpeg" />
<p class="caption"><span class="caption-number">Figure 39. </span><span class="caption-text">Bluetooth Low Energy Stack Development System</span></p>
</div>
<p>The solution platform includes the following components within the CC2640R2 SDK:</p>
<ul class="simple">
<li><strong>TI’s Real-Time Operating System (TI-RTOS)</strong> with the TI-RTOS SYS/BIOS kernel,
optimized power management support, and peripheral drivers (SPI, UART, and
so forth).</li>
<li><strong>DriverLib</strong> provides a device register abstraction layer and is used
by software and drivers to control the CC2640R2 at the lowest level.</li>
<li><strong>The Bluetooth Low Energy protocol stack</strong> is provided in library form with
parts of the protocol stack in the CC2640R2 ROM.</li>
<li><strong>Sample applications and profiles</strong> make starting development BLE application using both
custom and adopted solutions easier.</li>
</ul>
<p>The following integrated development environments (IDEs) are
supported:</p>
<ul class="simple">
<li>IAR Embedded Workbench for Arm</li>
<li>Code Composer Studio™ (CCS) using the TI Arm Compiler</li>
</ul>
<p>Refer to the SDK release notes for the specific IDE &amp; toolchain versions supported by this
release.</p>
</div>
<div class="section" id="ble-software-architecture">
<h2>BLE Software Architecture<a class="headerlink" href="#ble-software-architecture" title="Permalink to this headline">¶</a></h2>
<p>The CC2640R2 Bluetooth Low Energy software environment consists of the
following parts:</p>
<ul class="simple">
<li>An application with the TI-RTOS kernel, drivers and Bluetooth profile</li>
<li>A stack library that implements Bluetooth Low Energy Host and Controller protocol</li>
</ul>
<p>Some examples implement these as two separate projects. In some examples the stack
is prebuilt and linked as library files.</p>
<p>TI-RTOS is a real-time, pre-emptive, multithreaded operating system that
runs the software solution with task synchronization. Both the application and
Bluetooth Low Energy protocol stack exist as separate tasks within the RTOS. The
Bluetooth Low Energy protocol stack has the highest priority. A messaging
framework called indirect call (ICall) is used for thread-safe synchronization
between the application and stack. It is mandatory to use TI-RTOS and ICall when
developing an application with the BLE Stack.</p>
<ul class="simple">
<li>The stack includes the lower layers of the Bluetooth Low Energy protocol
stack from the Link Layer up to and including the GAP, GATT and
Security Manager (SM) layers. Most of the Bluetooth Low Energy protocol     stack
code is provided as a library.</li>
<li>The application includes the RTOS, profiles/services, application code,
drivers, and the ICall module.</li>
</ul>
<div class="section" id="single-project-configuration">
<span id="sec-architecture-single-project-config"></span><h3>Single Project Configuration<a class="headerlink" href="#single-project-configuration" title="Permalink to this headline">¶</a></h3>
<p>In BLE5-Stack 1.01.11.00, stack is pre-built as a library that is statically linked
to the application. This saves a build step compared to using a stack library
configuration project. See the example project’s README file for the available
project build configurations.</p>
<p>Stack library projects have the following properties:</p>
<blockquote>
<div><ul class="simple">
<li>Stack provided as pre-build library files</li>
<li>Application project will link the stack library files</li>
<li>There is no explicit app/stack boundary. The application’s link step
decides the memory locations of the code within the stack library.</li>
<li>This architecture saves flash by allowing the linker work more efficiently.</li>
<li>These projects used the improved ICall architecture</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="stack-library-configuration">
<span id="sec-inc-architecture-stack-image-as-a-library"></span><h3>Stack Library Configuration<a class="headerlink" href="#stack-library-configuration" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This configuration is used by example projects for device CC2640R2, and
only in project <code class="docutils literal notranslate"><span class="pre">host_test</span></code> for the CC13x2/26x2 devices.</p>
</div>
<p>In BLE5-Stack 1.01.11.00, stack is built as a library that is statically linked
to the application. Using this build configuration yields additional flash
footprint optimizations by the linker since the application and stack can share
contiguous flash pages. See the example project’s README file for the available
project build configurations.</p>
<p>Stack library projects have the following properties:</p>
<blockquote>
<div><ul class="simple">
<li>Stack project generates a static library (.lib)</li>
<li>Application project will link the stack in as a library</li>
<li>There is no explicit app/stack boundary. The application’s link step
decides the memory locations of the code within the stack library. There
are some exceptions to this such as <a class="reference internal" href="reference-cc2640.html#term-64"><span class="xref std std-term">SNV</span></a>.</li>
<li>This architecture saves flash by allowing the linker work more efficiently.</li>
<li>These projects used the improved ICall architecture</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="standard-project-task-hierarchy">
<span id="sec-inc-architecture-standard-project-task-hierarchy"></span><h3>Standard Project Task Hierarchy<a class="headerlink" href="#standard-project-task-hierarchy" title="Permalink to this headline">¶</a></h3>
<p>Bluetooth Low Energy sample applications use the following task priority structure.
A higher task number corresponds to a higher priority task:</p>
<ul class="simple">
<li>Priority 5: Bluetooth Low Energy protocol stack task (must be highest priority)</li>
<li>Priority 2: NPI task (network processor configurations only)</li>
<li>Priority 1: Application task (e.g., simple_peripheral)</li>
</ul>
<p>In addition, Software Interrupts (SWIs) are used for RF Driver operations.
Additional tasks may be inroducted but the relative priority structure above must be preserved.</p>
<p><a class="reference internal" href="tirtos-index.html#sec-tirtos-overview"><span class="std std-ref">TI-RTOS (RTOS Kernel) Overview</span></a> introduces TI-RTOS tasks.
<a class="reference internal" href="../ble-stack-5.x/overview-cc2640.html#sec-ble-stack-overview"><span class="std std-ref">Overview</span></a> describes interfacing with the Bluetooth low
energy protocol stack. <a class="reference internal" href="../ble-stack-5.x/the-application.html#start-up-in-main"><span class="std std-ref">Main initialization</span></a> describes the application task.</p>
</div>
</div>
<div class="section" id="working-with-hex-and-binary-files">
<span id="sec-inc-architecture-working-with-hex-files"></span><h2>Working With Hex and Binary Files<a class="headerlink" href="#working-with-hex-and-binary-files" title="Permalink to this headline">¶</a></h2>
<p>BLE5-Stack projects within this SDK are configured to produce an Intel-extended hex
file in their respective output folders. These hex files can be programmed
individually with a compatible flash programming tool, such as UniFlash.
To simplify the flash programming process, you can combine
the application with other Intel-extended hex files into a super hex file manually or using
freely available tools provided the individual hex files lack overlapping memory regions.
Information on the <a class="reference external" href="https://en.wikipedia.org/wiki/Intel_HEX">Intel Hex standard</a>.</p>
<p>One method for creating the super hex file is with the IntelHex python script
hex_merge.py, available at the <a class="reference external" href="https://launchpad.net/intelhex/+download">IntelHEX Canonical page</a>.
To merge the hex files, install Python® 2.7.x and add it to your system
path environment variables.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Note that when using any python script, you must use a compatible version
of Python. Refer to the tool documentation or contact the developer to
verify compatibility.</p>
</div>
<p>If conversion of the super hex to a binary file is desired, this can be accomplished
with the “hex2bin.py” or similar tools that support the hex standard.</p>
<div class="highlight-console notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="go">C:\Python27\Scripts&gt;python hex2bin.py \</span>
<span class="go">    simple_peripheral_super.hex \</span>
<span class="go">    simple_peripheral_super.bin</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="programming-internal-flash-with-the-rom-bootloader">
<h2>Programming Internal Flash with the ROM Bootloader<a class="headerlink" href="#programming-internal-flash-with-the-rom-bootloader" title="Permalink to this headline">¶</a></h2>
<p>The CC2640R2 internal flash memory can be programmed using the bootloader in the
ROM of the device. Both UART and SPI protocols are supported. For more details
on the programming protocol and requirements, see the Bootloader chapter of the
<a class="reference external" href="http://www.ti.com/lit/pdf/swcu117">CC13x0 CC26x0 SimpleLink Wireless MCU Technical Reference Manual</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because the ROM bootloader uses predefined DIO pins for internal flash
programming, allocate these pins in the layout of your board. For details on
the pins allocated to the bootloader based on the chip package type, see
<a class="reference external" href="http://www.ti.com/lit/pdf/swcu117">CC13x0 CC26x0 SimpleLink Wireless MCU Technical Reference Manual</a>.</p>
</div>
</div>
<div class="section" id="resetting-the-device-via-software">
<h2>Resetting the CC2640R2 via software<a class="headerlink" href="#resetting-the-device-via-software" title="Permalink to this headline">¶</a></h2>
<p>Use only system (hard) resets to reset the device from software. From software,
a reset can occur through one of the following.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">HCI_EXT_ResetSystemCmd</span><span class="p">(</span><span class="n">HCI_EXT_RESET_SYSTEM_HARD</span><span class="p">);</span>
<span class="n">SysCtrlSystemReset</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tirtos-index.html" class="btn btn-neutral float-right" title="TI-RTOS (RTOS Kernel) Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../quickstart-guide/ble5-quick-start-cc2640.html" class="btn btn-neutral float-left" title="TI BLE5-Stack Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        <a href="https://www.ti.com/corp/docs/legal/copyright.shtml">2010-2020, Texas Instruments</a>, Texas Instruments Incorporated. All rights reserved. <br>
        <a href="https://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="https://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="https://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="https://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>