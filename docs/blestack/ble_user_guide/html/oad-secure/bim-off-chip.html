

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BIM for Off-Chip OAD &mdash; 
SimpleLink™ CC2640R2 SDK
User&#39;s Guide for BLE-Stack 3.x.x
 3.03.05.00 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BIM for On-Chip OAD (Split Image)" href="bim-on-chip-split-image.html" />
    <link rel="prev" title="Boot Image Manager (BIM)" href="bim.html" />
    <script language="JavaScript">
        var tiPageName;
        tiPageName = "sug oad-secure bim-off-chip";

        if (location.protocol == "file:"){
            var ci_analytics_poc_load = true;
        }
    </script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>


</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for TI beyond RTD Sphinx Theme --->
<div class="DocSite-globalNav tiNav">
    <ul>
    </ul>
</div>

<a class="DocSite-nav" href="https://www.ti.com" style="padding-bottom: 85px;">
  <img class="DocSiteNav-logo"
    src="../_static/img/ti_logo.png"
    alt="TI Logo">
  <div class="DocSiteNav-title"></div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../ble-stack-3.x-guide/index.html" class="icon icon-home" alt="Documentation Home"> 
SimpleLink™ CC2640R2 SDK
User's Guide for BLE-Stack 3.x.x

          

          
          </a>

          
            
            
              <div class="version">
                3.03.05.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/disclaimer.html">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/get-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/platform.html">The CC2640R2 SDK Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/tirtos-index.html">TI-RTOS (RTOS Kernel) Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#ble-stack">BLE-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#developing-a-custom-application">Developing a Custom Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#ble-network-processor">BLE Network Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/ble-stack-3-index.html#running-the-sdk-on-custom-hardware">Running the SDK on Custom Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/u-stack-index.html">Micro BLE Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-common/npi-index.html">Network Processor Interface (NPI)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ble-stack-3.x-guide/index-oad-cc2640.html">Over-the-Air Download (OAD)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="oad-types.html">OAD Storage &amp; Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="bim.html">Boot Image Manager (BIM)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">BIM for Off-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="bim-on-chip-split-image.html">BIM for On-Chip OAD (Split Image)</a></li>
<li class="toctree-l2"><a class="reference internal" href="image-header.html">OAD Image Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="ext-flash-image-header.html">OAD External Flash Image Header</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash-layout-off-chip.html">Flash Layout for Off-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash-layout-on-chip-split-image.html">Flash Layout for On-Chip OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">OAD Image Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble3-stack-oad/oad-application.html">OAD Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble3-stack-oad/oad-profile.html">BLE-Stack OAD Profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble3-stack-oad/setting-up-environment.html">Setting up the BLE OAD Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble3-stack-oad/performing-an-oad.html">Performing a BLE OAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble3-stack-oad/creating-a-production-image.html">Creating a Production Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ble3-stack-oad/add-ble-oad-to-proj.html">Adding BLE OAD to an Existing Project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../voice/voice.html">Creating a Voice Enabled Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/secure-fw-index.html">Secure Firmware (SFW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensor-controller/sensor-controller.html">Sensor Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/debugging-index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/migration.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/api-reference.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ble-stack-3.x-guide/reference.html">Terms and Definitions</a></li>
</ul>

            
          
          <!-- extra nav elements for TI beyond RTD Sphinx Theme --->
<div id="sideBanner">
    <br/>
    <br/><br/><br/>
</div>
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../ble-stack-3.x-guide/index.html">
SimpleLink™ CC2640R2 SDK
User's Guide for BLE-Stack 3.x.x
</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../ble-stack-3.x-guide/index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../ble-stack-3.x-guide/index-oad-cc2640.html">Over-the-Air Download (OAD)</a> &raquo;</li>
        
      <li>BIM for Off-Chip OAD</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bim-for-off-chip-oad">
<span id="sec-oad-bim-off-chip"></span><h1>BIM for Off-Chip OAD<a class="headerlink" href="#bim-for-off-chip-oad" title="Permalink to this headline">¶</a></h1>
<p>This section describes the behavior of the <a class="reference internal" href="../ble-stack-3.x-guide/reference.html#term-78"><span class="xref std std-term">BIM</span></a> for off-chip OAD. This
approach requires an external flash to be connected to the device. As with
on-chip OAD, it is BIM’s responsibility to locate which image should be run.</p>
<p>At steady state, the normal case is that a valid image exists in internal flash
and no image in the external flash has been marked as needing to be copied. In
this case, BIM will validate that the image on internal flash and execute it
by loading the stack pointer and jumping to the image’s reset vector location.
BIM determines the location of the reset vector and stack pointer of the image
through the OAD image header attached to it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The execution flow below is assuming security is on. If using an unsecured
BIM configuration, the process is the same with the exception that there
is no check for security.</p>
</div>
<p>The following flowchart describes the process by which the BIM selects an
image.</p>
<div class="figure align-center" id="id3">
<p class="plantuml">
<img src="../_images/plantuml-66f23b70119c076e505face67e0a47b10d30abd4.png" alt="&#64;startuml
hide empty description

[*] --&gt; deviceBoot

deviceBoot : Device boots from a system reset\nand enters the BIM procedure
deviceBoot --&gt; checkExternalFlash

state checkExternalFlash {
    [*] --&gt; forEachExtImage

    forEachExtImage : For all images found\non the external flash
    forEachExtImage --&gt; validateExtImage : New image\nfound
    forEachExtImage --&gt; [*] : No more\nimages

    validateExtImage : Check the CRC valid flag\nand validate signature\nof the new image
    validateExtImage --&gt; copyProcedure : Accepted
    validateExtImage --&gt; forEachExtImage : Rejected

    copyProcedure : Copy image from external\nto internal flash
    copyProcedure --&gt; validateCopiedImage : Copy OK
    copyProcedure --&gt; forEachExtImage : Copy Failed

    validateCopiedImage : Perform CRC check\nand validate signature\nof the copied image
    validateCopiedImage --&gt; [*] : Accepted
    validateCopiedImage --&gt; forEachExtImage : Rejected
}

checkExternalFlash -down-&gt; runImage : Succeeded
checkExternalFlash -right-&gt; checkInternalFlash : Failed

state checkInternalFlash {
    [*] --&gt; forEachIntImage

    forEachIntImage : For all images found\non the internal flash
    forEachIntImage --&gt; validateIntImage : New image\nfound
    forEachIntImage --&gt; [*] : No more\nimages

    validateIntImage : Check the CRC valid flag\nand validate signature\nof the image
    validateIntImage --&gt; [*] : Accepted
    validateIntImage --&gt; forEachIntImage : Rejected
}

checkInternalFlash -down-&gt; runImage : Succeeded
checkInternalFlash -right-&gt; spinlock : Failed

spinlock --&gt; spinlock

runImage : Jump to image
runImage --&gt; [*]

&#64;enduml

Functional Overview of Off-chip BIM"/>
</p>
<p class="caption"><span class="caption-number">Figure 94. </span><span class="caption-text">Sequence diagram for BIM image selection process</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The image above is illustrated in words below. In order to determine which
image is best to run, BIM takes the following measures:</p>
<ol class="arabic">
<li><p class="first">At startup, BIM looks for a valid image header in external flash by reading
the first 8 bytes to find the valid External Flash Image Identification
value.</p>
</li>
<li><p class="first">After a valid header is found, it reads the entire header from ext flash
and verifies the compatibility of BIM and image header versions. Then it
checks if the ‘Image copy status’ is set to be copied to the on-chip
flash(0xFE) and has a valid CRC (CRC status=0xFE).</p>
<blockquote>
<div><ul class="simple">
<li>If a compatible header is found, secure versions of the BIM will check
the signature of the image using ECDSA verification algorithm.</li>
<li>If the CRC flag is not valid (CRC status != 0xFE) then it is rejected.</li>
<li>On finding the invalid CRC it moves on to read the next image’s header.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If a valid image is found, BIM copies the image to on-chip flash, as per
the image copy procedure.</p>
<blockquote>
<div><ul class="simple">
<li>After the copy, the CRC is calculated and signature is validated again
on the internal flash to ensure the copy succeeded.</li>
<li>If the copy failed the status byte is updated and the BIM will continue
searching external flash.</li>
<li>If the copy succeeded, then the BIM will verify the image again and if
successful jump directly to the application image, and the search
process ends.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If BIM reaches the end of the image header region in external flash without
finding a valid image, then it will try to find an on-chip image and
execute it.</p>
</li>
<li><p class="first">If BIM fails to find a valid image internal flash, it will attempt to
revert the factory image if there is one present.</p>
</li>
<li><p class="first">BIM will put the device to low power mode if it fails to find a valid
application image.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An image is considered bad/invalid if it’s calculated CRC32 does not match
the image’s CRC bytes embedded in the image header.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bim-on-chip-split-image.html" class="btn btn-neutral float-right" title="BIM for On-Chip OAD (Split Image)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bim.html" class="btn btn-neutral float-left" title="Boot Image Manager (BIM)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        <a href="https://www.ti.com/corp/docs/legal/copyright.shtml">2010-2020, Texas Instruments</a>, Texas Instruments Incorporated. All rights reserved. <br>
        <a href="https://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="https://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="https://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="https://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>